<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تتبع جسم على فيديو</title>
<style>
  body, html { margin: 0; padding: 0; overflow: hidden; background: black; font-family: sans-serif; }
  video {
    position: absolute;
    width: 100%;
    height: auto;
    top: 0;
    left: 0;
  }
  #overlayCircle {
    position: absolute;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid red;
    pointer-events: none;
  }
  #controls {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(255,255,255,0.8);
    padding: 5px 10px;
    border-radius: 8px;
    z-index: 10000;
  }
</style>
</head>
<body>

<div id="controls">
  اختر الفيديو: <input type="file" id="videoInput" accept="video/*"><br><br>
  تتبع: 
  <select id="objectSelector">
    <option value="person">شخص</option>
    <option value="sports ball">كرة</option>
    <option value="cup">كوب</option>
    <option value="teddy bear">دمية</option>
    <option value="cat">قطة</option>
    <option value="dog">كلب</option>
  </select>
</div>

<video id="video" autoplay muted playsinline></video>
<div id="overlayCircle"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<script>
const video = document.getElementById("video");
const circle = document.getElementById("overlayCircle");
const selector = document.getElementById("objectSelector");
const videoInput = document.getElementById("videoInput");

let selectedClass = selector.value;

selector.addEventListener("change", () => {
  selectedClass = selector.value;
});

let model;

// تحميل نموذج Coco-SSD
cocoSsd.load().then(loadedModel => {
  model = loadedModel;
});

// عند اختيار فيديو
videoInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if(!file) return;
  const url = URL.createObjectURL(file);
  video.src = url;
  video.play();
  video.onloadeddata = () => {
    detectFrame();
  }
});

// دالة التتبع
async function detectFrame() {
  if(video.paused || video.ended || !model) {
    requestAnimationFrame(detectFrame);
    return;
  }

  const predictions = await model.detect(video);

  const target = predictions.find(p => p.class === selectedClass);

  if(target) {
    const [x, y, w, h] = target.bbox;
    circle.style.left = (x + w/2 - circle.offsetWidth/2) + 'px';
    circle.style.top  = (y + h/2 - circle.offsetHeight/2) + 'px';
  }

  requestAnimationFrame(detectFrame);
}
</script>
</body>
</html>
