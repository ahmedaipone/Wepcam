<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body, html { margin: 0; padding: 0; overflow: hidden; background: black; }
  video {
    position: absolute;
    width: 100%;
    height: auto;
    transform: scaleX(-1); /* انعكاس للمرايا */
  }
  #overlayCircle {
    position: absolute;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid red;
    pointer-events: none;
  }
</style>
</head>
<body>
<video id="video" autoplay muted playsinline></video>
<div id="overlayCircle"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<script>
const video = document.getElementById("video");
const circle = document.getElementById("overlayCircle");

async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
  video.srcObject = stream;
  return new Promise(resolve => video.onloadedmetadata = resolve);
}

async function init() {
  await startCamera();

  const model = await cocoSsd.load();
  detectFrame(model);
}

async function detectFrame(model) {
  const predictions = await model.detect(video);
  
  if(predictions.length > 0) {
    // نختار أول هدف مكتشف (تقدر تحدد نوع معين مثل 'person' أو 'sports ball')
    const target = predictions[0].bbox; // [x, y, width, height]
    const [x, y, w, h] = target;

    // نحرك الدائرة لمركز الهدف
    circle.style.left = (x + w/2 - circle.offsetWidth/2) + 'px';
    circle.style.top  = (y + h/2 - circle.offsetHeight/2) + 'px';
  }

  requestAnimationFrame(() => detectFrame(model));
}

init();
</script>
</body>
</html>
