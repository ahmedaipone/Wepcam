<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تتبع أي جسم على الشاشة</title>
<style>
  body, html { margin:0; padding:0; background:#000; overflow:hidden; font-family:sans-serif; color:white; }
  video#screenVideo { position:absolute; top:0; left:0; width:100%; height:100%; }
  #overlayCircle {
    position:absolute;
    width:60px;
    height:60px;
    border-radius:50%;
    border:3px solid red;
    pointer-events:none;
    z-index:9999;
    transition: all 0.05s linear;
  }
  #controls {
    position:fixed; top:10px; left:10px; z-index:10000;
    background:rgba(0,0,0,0.6); padding:10px; border-radius:5px;
  }
  select, input, button { margin:5px 0; padding:5px; width:100%; }
</style>
</head>
<body>

<div id="controls">
  <button id="startScreenBtn">اختر الشاشة للتتبع</button>
  <label>اختر الجسم للتتبع:</label>
  <select id="targetSelect">
    <option value="cup">كوب</option>
    <option value="person">وجه</option>
    <option value="doll">دمية</option>
    <option value="sports ball">كرة</option>
    <option value="car">سيارة</option>
    <option value="cat">حيوان</option>
  </select>
  <label>لون الدائرة:</label>
  <input type="color" id="circleColor" value="#ff0000">
  <label>حجم الدائرة:</label>
  <input type="range" id="circleSize" min="30" max="150" value="60">
</div>

<video id="screenVideo" autoplay muted playsinline></video>
<div id="overlayCircle"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<script>
let video = document.getElementById('screenVideo');
let circle = document.getElementById('overlayCircle');
let targetClass = 'cup';
let model = null;

document.getElementById('targetSelect').addEventListener('change', e=>{ targetClass = e.target.value; });
document.getElementById('circleColor').addEventListener('input', e=>{ circle.style.borderColor = e.target.value; });
document.getElementById('circleSize').addEventListener('input', e=>{
  let size = parseInt(e.target.value);
  circle.style.width = size + 'px';
  circle.style.height = size + 'px';
});

// اختيار الشاشة
document.getElementById('startScreenBtn').addEventListener('click', async ()=>{
  try{
    const stream = await navigator.mediaDevices.getDisplayMedia({ video:true });
    video.srcObject = stream;
    if(!model) model = await cocoSsd.load();
    detectFrame();
  }catch(err){ alert('لم يتم اختيار الشاشة'); }
});

async function detectFrame(){
  if(video.paused || video.ended) return;
  const predictions = await model.detect(video);
  let targetBox = null;

  for(let p of predictions){
    if(p.class === targetClass){
      targetBox = p.bbox;
      break;
    }
  }

  if(targetBox){
    const [x,y,w,h] = targetBox;
    circle.style.left = x + w/2 - circle.offsetWidth/2 + 'px';
    circle.style.top  = y + h/2 - circle.offsetHeight/2 + 'px';
  }

  requestAnimationFrame(detectFrame);
}
</script>

</body>
</html>
